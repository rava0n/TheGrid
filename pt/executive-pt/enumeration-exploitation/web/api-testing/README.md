# API Testing

## API recon



### API Documentation

Trying to find a documentation for the tested API, it's usefull to having all endpoints list and to knowing what them do and work.

Common path for API documentation:

```
/api
/SERVICE_NAME/index.html
/openapi.json
/docs
```

Or using this wordlist:

{% code overflow="wrap" %}
```bash
/usr/share/wordlists/SecLists/Discovery/Web-Content/api/api-endpoints.txt

# wfuzz 
wfuzz -c -z file,/usr/share/wordlists/SecLists/Discovery/Web-Content/api/api-endpoints.txt 'http://domain.com/FUZZ'
```
{% endcode %}

### API machine-readable docs

To read the machine-readable docs we can use the OpenAPI Parser Burp Suite tool uploading the `yaml` or `json` file.&#x20;



### Identifying and Interacting with API endpoints

You can use Burp Scanner to crawl the application, then manually investigate interesting attack surface using Burp's browser.

Navigate throught the website with Burp Proxy and then check in the target session what api has discovered.

<figure><img src="../../../../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>



Once you've identified API endpoints, interact with them using Burp Repeater and Burp Intruder. This enables you to observe the API's behavior and discover additional attack surface



### Identifying supp HTTP methods

An API endpoint may support different HTTP methods. It's therefore **important to test all potential methods when you're investigating API endpoints**. This may **enable you to identify additional endpoint functionality**, opening up more attack surface.



### Identifying supported content types

API endpoints often expect data in a specific format. They may therefore behave differently depending on the content type of the data provided in a request.

To change the content type, modify the `Content-Type` header, then reformat the request body accordingly. You can use the `Content type converter BApp` to automatically convert data submitted within requests between XML and JSON.

<figure><img src="../../../../../.gitbook/assets/image (13) (1).png" alt=""><figcaption></figcaption></figure>

### API Endpoints Fuzzing

Once you have identified some initial API endpoints, we can try to fuzzing hidden endpoints to find out other route.

{% code overflow="wrap" %}
```bash
wfuzz -c -z file,/usr/share/wordlists/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt 'http://domain.com/api/FUZZ'

wfuzz -c -z file,/usr/share/wordlists/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt 'http://domain.com/api/read_file?file=FUZZ'

# filter (to insert before the URL):
# --sc: filter only a specific code ex 200
# --hc: hide all specific code ex 200
```
{% endcode %}

In alternative Burp includes numerous tools that can help you identify hidden parameters:

* **Burp Intruder** enables you to automatically discover hidden parameters, using a wordlist of common parameter names to replace existing parameters or add new parameters. Make sure you also include names that are relevant to the application, based on your initial recon.
* The **Param miner BApp** enables you to automatically guess up to 65,536 param names per request. Param miner automatically guesses names that are relevant to the application, based on information taken from the scope.
* The Content discovery tool enables you to discover content that isn't linked from visible content that you can browse to, including parameters.

{% code title="Wordlists" %}
```
/usr/share/wordlists/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt
```
{% endcode %}



## Mass assignment

{% content-ref url="mass-assignment.md" %}
[mass-assignment.md](mass-assignment.md)
{% endcontent-ref %}



## API Development Best Practices

When designing APIs, make sure that security is a consideration from the beginning. In particular, make sure that you:

* Secure your documentation if you don't intend your API to be publicly accessible.
* Ensure your documentation is kept up to date so that legitimate testers have full visibility of the API's attack surface.
* Apply an allowlist of permitted HTTP methods.
* Validate that the content type is expected for each request or response.
* Use generic error messages to avoid giving away information that may be useful for an attacker.
* Use protective measures on all versions of your API, not just the current production version.

To prevent mass assignment vulnerabilities, allowlist the properties that can be updated by the user, and blocklist sensitive properties that shouldn't be updated by the user.
