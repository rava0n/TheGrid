# Session LifeCycle

Sometimes the Session lifecycle can has vulnerability to use for bypass Authentication or Authorization process.

The methodology to detect this vuln is the follow:



## Enumeration

first need to map out the lifecycle for ourselves and capture detailed notes. Once we understand the intended lifecycle, we can start looking for weaknesses.



1. Check when the cookies/tokens are creating

Open the Inspection tab in the browser, and analyze when the cookies or tokens are creating.

* Before the authentication: the site tracks the action also as unauthenticated user
* After authentication: the site create it when a user make the login&#x20;



2. Check if the site uses Cookies or Tokens to keep tracks of the user's actions

Looking the Browser storage we able to detect the type of session management is used.



3. Check what flags to the HTTP Cookie header have been apply.&#x20;

The flags could be:

* **Secure** - Indicates to the browser that the cookie may only be transmitted over verified HTTPS channels. If there are certificate errors or HTTP is used, the cookie value will not be transmitted.
* **HTTPOnly** - Indicates to the browser that the cookie value may not be read by client-side JavaScript.
* **Expire** - Indicates to the browser when a cookie value will no longer be valid and should be removed.
* **SameSite** - Indicates to the browser whether the cookie may be transmitted in cross-site requests to help protect against CSRF attacks.



4. Check the Session Expiry of the cookies/tokens



5. Using Burp, monitoring the web request and understand how they been authenticated

The cookie can be passed in the request in the `Cookie` header.&#x20;

The tokens can be used in the `Authorization: Bearer` header



6. Test logout functionability

Save the current cookie and then test to take these actions:

* Clear the cookies from the Storage and then try to make an authenticated request
* Press Logout button, loggin again and try to replace the new cookie to the old cookie and make the request, to check if the server-side has disabled the old token



7. Local Storage variables

Check if there are some variables in the local storage that an attacker can use to Escalate Privileges (ex: userRole, isAdmin, ...)



## Defences

To defend against session attacks, it is important to implement a secure session management lifecycle. While several items were touched on in this room, let's take a look at a recap:

* The session's values must be stored securely, regardless of being a cookie or a token.
* The session values themselves must be either sufficiently random and non-guessable or use a signing mechanism to ensure that they cannot be tampered with.
* Sessions should be used to track user actions and perform authorisation checks to ensure the user can perform the requested action.
* Sessions should expire after a set amount of time to prevent them from being used for persistent access.
* If the logout button is pressed, the session should be removed client-side and invalidated server-side. Otherwise, a user would be unable to destroy their session if it was compromised.
